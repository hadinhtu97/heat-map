<link rel="stylesheet" href="exam.css">
<script src="https://d3js.org/d3.v6.min.js"></script>

<div id="heat-map">
    <div id="tooltip"></div>
    <div id="title">
        Monthly Global Land-Surface Temperature
    </div>
    <div id="description">
        1753 - 2015, baseTemperature: 8.66
    </div>
    <div id="graph"></div>
    <div id="legend"></div>
</div>

<script>
    fetch('https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/global-temperature.json')
        .then(response => response.json())
        .then(val => {

            const data = val.monthlyVariance;
            const w = 1200;
            const h = 600;
            const w_d = 800;
            const h_d = 50;
            const padding = 60;

            const graph = d3.select('#graph')
                .append('svg')
                .attr('width', w)
                .attr('height', h)
            const legend = d3.select('#legend')
                .append('svg')
                .attr('width', w_d)
                .attr('height', h_d)
            const tooltip = d3.select('#tooltip')
                .attr('data-year', '')
                .text('')
                .style('opacity', 0)

            const xScale = d3.scaleLinear()
                .domain([1753, 2016])
                .range([padding, w - padding])
            const yScale = d3.scaleLinear()
                .domain([0, 12])
                .range([h - padding, padding])
            const numberToMonth = x => x === 1 ? 'January' : x === 2 ? 'February' : x === 3 ? 'March' : x === 4 ? 'April' : x === 5 ? 'May' : x === 6 ? 'June' : x === 7 ? 'July' : x === 8 ? 'August' : x === 9 ? 'September' : x === 10 ? 'October' : x === 11 ? 'November' : x === 12 ? 'December' : '';
            const xAxis = d3.axisBottom(xScale).tickFormat(d3.format(''));
            const yAxis = d3.axisLeft(yScale).tickFormat(numberToMonth);
            graph.append('g')
                .attr('transform', 'translate(0,' + (h - padding) + ')')
                .call(xAxis)
                .attr('id', 'x-axis')
            graph.append('g')
                .attr('transform', 'translate(' + padding + ',0)')
                .call(yAxis)
                .attr('id', 'y-axis')
            const rect = graph.selectAll('rect')
                .data(data)
                .enter()
                .append('rect')
                .attr('x', d => xScale(d.year))
                .attr('y', d => yScale(d.month))
                .attr('width', (w - 2 * padding) / 262)
                .attr('height', (h - 2 * padding) / 12)
                .attr('fill', d => d.variance < -5.66 ? 'dodgerblue' : -5.66 <= d.variance && d.variance < -2.66 ? 'teal' : d.variance >= -2.66 && d.variance < 0.34 ? 'burlywood' : 'chocolate')
                .on('mouseover', function (even, d) {
                    d3.select(this).style('stroke', '#5e0080')
                    tooltip.attr('data-year', d.year)
                        .html(
                            numberToMonth(d.month) + ', ' + d.year + '<br>' + parseFloat(8.66 + d.variance).toFixed(3) + '&deg;C<br>' + d.variance + '&deg;C'
                        )
                        .style('opacity', 1)
                        .style('left', (event.pageX + 20) + 'px')
                        .style('top', event.pageY + 'px')
                })
                .on('mouseout', function (even, d) {
                    d3.select(this).style('stroke', 'none')
                    tooltip.attr('data-year', '')
                        .style('opacity', 0)
                        .style('left', '0px')
                        .style('top', '0px')
                        .text('')
                })
                .attr('class', 'cell')
                .attr('data-month', d => d.month)
                .attr('data-year', d => d.year)
                .attr('data-temp', d => d.variance)

            legend.append('rect')
                .attr('x', 0)
                .attr('y', 0)
                .attr('width', 20)
                .attr('height', 20)
                .attr('fill', 'dodgerblue')
            legend.append('text')
                .attr('x', 25)
                .attr('y', 15)
                .text('T < 3')
                .style('font-size', '10px')
            legend.append('rect')
                .attr('x', 200)
                .attr('y', 0)
                .attr('width', 20)
                .attr('height', 20)
                .attr('fill', 'teal')
            legend.append('text')
                .attr('x', 225)
                .attr('y', 15)
                .text('3 <= T < 6')
                .style('font-size', '10px')
            legend.append('rect')
                .attr('x', 400)
                .attr('y', 0)
                .attr('width', 20)
                .attr('height', 20)
                .attr('fill', 'burlywood')
            legend.append('text')
                .attr('x', 425)
                .attr('y', 15)
                .text('6 <= T < 9')
                .style('font-size', '10px')
            legend.append('rect')
                .attr('x', 600)
                .attr('y', 0)
                .attr('width', 20)
                .attr('height', 20)
                .attr('fill', 'chocolate')
            legend.append('text')
                .attr('x', 625)
                .attr('y', 15)
                .text('9 <= T')
                .style('font-size', '10px')
        })
</script>
<script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>